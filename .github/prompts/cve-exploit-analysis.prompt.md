---
mode: agent
description: CVE Exploit Analysis from VEX generation workflow
tools: ['changes', 'codebase', 'editFiles', 'extensions', 'fetch', 'findTestFiles', 'githubRepo', 'new', 'openSimpleBrowser', 'problems', 'runCommands', 'runNotebooks', 'runTasks', 'search', 'searchResults', 'terminalLastCommand', 'terminalSelection', 'testFailure', 'usages', 'vscodeAPI', 'Trivy MCP', 'vexdoc-mcp', 'osv-mcp']
---

# CVE Exploit Analysis Workflow

**PURPOSE**: Analyze security reports to provide detailed exploit scenarios and proof-of-concept demonstrations for CVE vulnerabilities only. This workflow transforms CVE findings into actionable security intelligence for penetration testing and risk assessment.

**‚ö†Ô∏è CRITICAL**: You MUST start by asking the user for which report they want to base this from. They are located in `docs/security/reports/[report_name]`. Scanning scope is in the `summary.md`

**üö® ANALYSIS ONLY - NO EXPLOIT CREATION**: This workflow performs ANALYSIS and DOCUMENTATION only. Do NOT create actual exploit files, attack scripts, or executable proof-of-concept code. All examples should be theoretical demonstrations in documentation format only. 

## CORE PRINCIPLE: CVE Exploitability Analysis ONLY

## CORE PRINCIPLE: From CVE Finding to Exploitation

Transform CVE security report findings into practical exploit scenarios by:
1. **CVE Research**: Deep-dive into vulnerability databases for technical details
2. **Library Analysis**: Examine vulnerable library usage patterns and attack surfaces
3. **CVE Exploit Development**: Create proof-of-concept demonstrations for CVE vulnerabilities
4. **CVE Risk Validation**: Confirm CVE exploitability in the specific application context

## Step 1: CVE Report Analysis and Prioritization

**Objective**: Extract ALL CVE vulnerabilities from the security report and create a prioritized analysis queue for iterative processing.

**Actions**:
1. **Parse Report**: Extract ALL CVE IDs from the vex.json in the security report directory
   - Identify CVE identifiers, affected components, and VEX status
   - Collect basic details (severity, component, VEX status) for each CVE
   - Ensure ALL CVEs are included, not just those marked as exploitable
2. **CVE Prioritization**: Sort ALL CVEs for analysis based on:
   - **Severity**: Critical/High priority first
   - **VEX Status**: "affected" or potentially "exploitable" determinations prioritized
   - **Library Usage**: Evidence of active usage in application
   - **Public Exploits**: Availability of known exploitation techniques
3. **Analysis Queue**: Create ordered list for iterative processing

**Deliverables**:
- Complete CVE inventory with ALL vulnerabilities found
- Prioritized analysis queue for systematic processing
- Current CVE selection for this iteration

**SCOPE LIMITATION**: This analysis covers ONLY vulnerabilities with CVE identifiers. Custom application vulnerabilities, OWASP findings, and business logic flaws are explicitly excluded.

**ITERATIVE PROCESSING**: Process ALL CVEs one-by-one through multiple analysis cycles, clearing context between each CVE to prevent overflow.

## Step 2: Current CVE Intelligence Gathering

**Objective**: Use OCV-MCP tools to gather comprehensive vulnerability intelligence for the CURRENT CVE being analyzed (from the prioritized queue).

**CONTEXT MANAGEMENT**: This step focuses ONLY on the current CVE. Previous CVE analysis data should be cleared from working memory.

**Required Research for the Current CVE**:
1. **OSV Database Lookup**: Get official vulnerability details, affected versions, references
2. **GHSA ID Extraction and Lookup**:
   - **Parse JSON Results**: Extract GHSA ID if present in the vulnerability scan results
   - **GHSA Database Query**: If GHSA ID found, use it to lookup detailed GitHub Security Advisory
   - **Cross-Reference Analysis**: Compare OSV and GHSA data for comprehensive intelligence
3. **Additional GHSA Analysis**: GitHub Security Advisory details, exploitation examples, patches
4. **Exploit Database Search**: Public exploits, proof-of-concepts, attack techniques
5. **Vendor Advisories**: Original security bulletins with technical details

**GHSA Lookup Workflow**:
1. **JSON Result Parsing**:
   - Examine vulnerability scan JSON output for GHSA identifiers
   - Look for GHSA-XXXX-XXXX-XXXX format in aliases, references, or related fields
   - Extract GHSA ID for targeted lookup

2. **GHSA Intelligence Gathering**:
   - Use OCV-MCP tools to query GHSA database with extracted ID
   - Retrieve GitHub Security Advisory detailed information
   - Cross-reference GHSA data with OSV findings for completeness

3. **GHSA Data Priority**:
   - **High Priority**: Exploitation examples, proof-of-concept code, attack vectors
   - **Medium Priority**: Patch timelines, affected versions, ecosystem analysis
   - **Standard Priority**: General advisory information, severity ratings

4. **Intelligence Synthesis**:
   - Combine OSV and GHSA data for comprehensive vulnerability profile
   - Identify conflicts or additional details between sources
   - Prioritize GHSA exploitation examples for practical attack development

**Key Intelligence to Collect**:
- **Attack Vectors**: Network, local, physical access requirements
- **Complexity Assessment**: Skills and resources needed for exploitation
- **Prerequisites**: Authentication, user interaction, specific conditions
- **Impact Scope**: Confidentiality, integrity, availability consequences
- **Exploit Examples**: Working proof-of-concepts or attack code
- **Mitigation Bypass**: Techniques to circumvent defensive measures
- **GHSA-Specific Intelligence**:
  - **Exploitation Examples**: Real-world attack demonstrations from GHSA
  - **Patch Information**: Fix details and remediation timelines
  - **Ecosystem Impact**: Broader implications across related packages
  - **Community Response**: Developer and security community insights

**Documentation Template**:
```
CVE-ID: [identifier]
GHSA-ID: [GitHub Security Advisory ID if available]
Severity: [CVSS score and vector]
Affected Component: [library/framework/version]

Technical Details:
- Root Cause: [vulnerability mechanism]
- Attack Surface: [entry points, interfaces]
- Exploitation Method: [step-by-step technique]
- Required Conditions: [prerequisites for success]

Intelligence Sources:
- OSV: [link and key details]
- GHSA: [link and exploitation examples] (if GHSA ID found in JSON)
- GHSA Cross-Reference: [comparison of OSV vs GHSA data]
- Exploit-DB: [public exploits available]
- Vendor Advisory: [original security bulletin]

GHSA Intelligence (if available):
- GHSA Severity Assessment: [GitHub's severity rating]
- GHSA Exploit Examples: [specific attack demonstrations]
- GHSA Patch Status: [fix availability and timeline]
- GHSA Ecosystem Impact: [broader package implications]
```

## Step 3: Current CVE Library Integration Analysis

**Objective**: Trace execution flows from CVE-affected library usage points to vulnerable functions to confirm CVE exploitability in the application context for the CURRENT CVE being analyzed.

**CONTEXT FOCUS**: Analyze ONLY the current CVE's library integration. Do not reference or load details from previous CVE analyses.

**CVE-Focused Integration Analysis Process**:
1. **CVE Library Usage Identification**: Find where the CVE-affected library is imported and used
2. **CVE Function Call Tracing**: Follow application code that calls CVE-vulnerable library functions
3. **CVE Data Flow Analysis**: Track how user input reaches CVE-vulnerable library code
4. **CVE Trigger Points**: Locate exact library functions that contain the CVE vulnerability
5. **CVE Bypass Analysis**: Identify ways to circumvent application-level protections that might mitigate CVE vulnerabilities

**Critical CVE Questions to Answer**:
- How does the application use the CVE-affected library?
- What user input can reach the CVE-vulnerable library functions?
- Are there application-level validations that prevent CVE exploitation?
- Can CVE library-level protections be bypassed through application usage patterns?
- What are the exact conditions needed for CVE exploitation?

**CVE Evidence Collection**:
- **CVE Library Imports**: How CVE-affected library is included
- **CVE Function Calls**: Specific usage of CVE-vulnerable library functions
- **CVE Data Paths**: How external input flows to CVE-vulnerable functions
- **CVE Usage Patterns**: Application-specific ways CVE-affected library is utilized

## Step 4: Current CVE Library Exploit Development

**Objective**: Create working demonstrations that prove the CURRENT CVE vulnerability can be exploited through the application's usage patterns of the affected library.

**FOCUSED ANALYSIS**: Develop exploits ONLY for the current CVE. Previous CVE exploit details should not influence this analysis.

**CVE Library PoC Development Framework**:

### A. CVE Dependency Injection Exploits
```python
# Example: CVE-specific vulnerable library function exploitation
# CVE-2023-XXXX in requests library (hypothetical)
import requests

# CVE-specific malicious payload
cve_payload = {
    "url": "http://evil.com/cve-exploit",
    "headers": {"X-CVE-Exploit": "cve_specific_payload"}
}

# Application code that triggers CVE vulnerability
response = requests.get(cve_payload["url"], headers=cve_payload["headers"])
# Impact: Remote code execution through CVE vulnerability
```

### B. CVE Serialization Library Exploits
```python
# Example: CVE in Pickle/YAML deserialization
# CVE-2023-YYYY in PyYAML (hypothetical)
import pickle
import yaml

# CVE-specific malicious serialized payload
cve_pickle = "cve_specific_pickle_payload"
cve_yaml = "cve_specific_yaml_payload"

# Application usage that triggers CVE
data = pickle.loads(base64.b64decode(cve_pickle))
# Impact: Code execution during CVE-vulnerable deserialization
```

### C. CVE Template Engine Exploits
```python
# Example: CVE in Jinja2/Template injection
# CVE-2023-ZZZZ in Jinja2 (hypothetical)
from jinja2 import Template

# CVE-specific template payload
cve_template = "{{ cve_specific_jinja2_exploit }}"

# Application usage that triggers CVE
template = Template(cve_template)
result = template.render()
# Impact: Server-side template injection via CVE
```

### D. CVE Cryptographic Library Exploits
```python
# Example: CVE in cryptographic library
# CVE-2023-AAAA in hashlib (hypothetical)
import hashlib

# CVE-vulnerable usage pattern
cve_weak_hash = hashlib.vulnerable_function(password.encode())
# Impact: Password cracking through CVE vulnerability
```

**CVE Library PoC Requirements**:
- **CVE-Specific**: Target actual CVE-vulnerable library functions used by the application
- **CVE Application Context**: Show how the CVE manifests through application usage
- **CVE Realistic Scenarios**: Demonstrate practical CVE exploitation paths
- **CVE Safe Testing**: Non-destructive proof that validates the CVE vulnerability
- **‚ö†Ô∏è DOCUMENTATION ONLY**: All PoCs should be theoretical examples in documentation. Do NOT create actual exploit files or executable attack code.

## Step 5: Individual CVE Document Generation and Context Clearing

**Objective**: Create comprehensive CVE exploit documentation for the CURRENT CVE, save it, and clear analysis context for the next CVE.

**Deliverable**: `[CVE-ID]-exploit-analysis.md` stored in the security report directory.

**CONTEXT MANAGEMENT**: After generating and saving the CVE document, clear all analysis context related to this CVE to prevent memory overflow when processing the next CVE.

**Individual CVE Document Template**:
```markdown
# [CVE-ID] Library Exploit Analysis: [Vulnerability Name]

## Vulnerability Overview
- **CVE ID**: [CVE identifier]  
- **Library**: [vulnerable library name and version]
- **Severity**: [CVSS score and impact]
- **Exploitability**: [complexity assessment]

## Intelligence Summary
- **OSV Details**: [key findings from OSV database]
- **GHSA Information**: [GitHub Security Advisory insights]
- **Public Exploits**: [available proof-of-concepts targeting this library]
- **Vendor Response**: [patches, workarounds, timeline]

## Technical Analysis
### Root Cause
[Detailed explanation of the library vulnerability mechanism]

### Library Attack Surface
- **Vulnerable Functions**: [specific library functions containing the vulnerability]
- **Required Usage Patterns**: [how the application must use the library to be vulnerable]
- **Prerequisites**: [conditions that must be met for exploitation]

### Application Integration Analysis
1. **Library Import**: [how the vulnerable library is included]
2. **Function Usage**: [where application code calls vulnerable library functions]
3. **Data Flow**: [how user input reaches vulnerable library code]
4. **Vulnerability Trigger**: [exact usage pattern that triggers the vulnerability]

## Proof-of-Concept Library Exploit

### Attack Vector
[Step-by-step exploitation through library usage]

### Exploit Payload
```
[Actual exploit payload targeting the library vulnerability]
```

### Application Usage Pattern
```python
# Vulnerable application code that triggers library exploit
[Code showing how application usage enables exploitation]
```

### Expected Impact
- **Library-Level Effect**: [what happens within the vulnerable library]
- **Application Impact**: [how library exploitation affects the application]
- **System Consequences**: [broader system implications]
- **Data Exposure**: [information that could be compromised through library exploit]

### Demonstration Steps
1. [Step 1: Identify vulnerable library usage]
2. [Step 2: Craft library-specific payload]
3. [Step 3: Trigger vulnerability through application]

## Risk Assessment
- **Likelihood**: [probability of exploitation through library usage]
- **Business Impact**: [consequences for organization]
- **Library Impact**: [scope of library-specific compromise]
- **Upgrade Urgency**: [criticality of library updates]

## Remediation Validation
### Library Update
[Specific library version updates needed]

### Usage Pattern Changes
[Application code changes to prevent exploitation]

### Testing Instructions
[How to verify the library fix prevents exploitation]

### Verification Commands
```bash
[Commands to test that library vulnerability is patched]
```

## References
- **Library Advisory**: [vendor-specific security bulletin]
- **OSV**: [link to OSV entry]
- **GHSA**: [link to GitHub Security Advisory]
- **Library Repository**: [official library security information]
```

## Step 6: Progress Tracking and Queue Management

**Objective**: Track analysis progress and determine next steps for continued CVE processing.

**Progress Management**:
1. **Mark Current CVE Complete**: Update analysis queue to mark current CVE as analyzed
2. **Save Progress State**: Record which CVEs have been completed
3. **Next CVE Selection**: Identify next highest-priority CVE from remaining queue
4. **Context Reset Confirmation**: Verify previous CVE analysis context has been cleared
5. **Continue or Summarize**: Determine whether to continue with next CVE or generate executive summary

**Decision Points**:
- **Continue Analysis**: If more CVEs remain in queue and user wants to continue
- **Generate Summary**: If all CVEs completed or user requests executive summary
- **Session Break**: If context needs to be fully reset due to memory constraints

**Queue Status Template**:
```
Total CVEs Found: [count]
CVEs Analyzed: [count]
CVEs Remaining: [count]
Current Session: [CVE-ID being analyzed]
Next in Queue: [next CVE-ID]
```

## Step 7: Executive Summary Generation

**Objective**: After analyzing multiple CVEs (or all CVEs), create an executive summary that provides high-level overview of all CVE exploit analyses performed.

**When to Generate**:
- After completing all CVEs in the queue
- When user requests summary during analysis
- After analyzing significant number of CVEs (5-10)
- When approaching context limits and need to summarize progress

**Deliverable**: `executive-summary-exploit-analysis.md` stored in the same directory as the original security report.

**Executive Summary Structure**:
```markdown
# CVE Exploit Analysis Executive Summary: [Product Name]

## Assessment Overview
- **Analysis Period**: [start date] to [end date]
- **Total CVEs Analyzed**: [count]
- **CVE Documents Generated**: [count]
- **Methodology**: Individual deep-dive analysis per CVE

## Critical Findings Summary
- **Immediately Exploitable CVEs**: [count and brief list]
- **Conditionally Exploitable CVEs**: [count and conditions]
- **Non-Exploitable CVEs**: [count with rationale]
- **Highest Risk CVE**: [CVE-ID with impact summary]

## CVE Analysis Summary Table
| CVE ID | Library | Severity | Exploitable | Impact | Priority | Document |
|--------|---------|----------|-------------|--------|----------|----------|
| CVE-YYYY-NNNN | [library] | Critical | Yes | RCE | P0 | [CVE-ID]-exploit-analysis.md |
| CVE-YYYY-NNNN | [library] | High | No | N/A | P3 | [CVE-ID]-exploit-analysis.md |

## Business Impact Assessment
### Critical Threats
1. **[CVE-ID]**: [Business impact and urgency]
2. **[CVE-ID]**: [Business impact and urgency]
3. **[CVE-ID]**: [Business impact and urgency]

### Risk Prioritization
- **Immediate Action Required**: [P0 CVEs requiring instant remediation]
- **Urgent Fixes**: [P1 CVEs for next maintenance window]
- **Planned Updates**: [P2 CVEs for regular update cycle]

## Key Recommendations
1. **Immediate Library Updates**: [specific version updates needed]
2. **Application Code Changes**: [usage pattern modifications required]
3. **Security Controls**: [additional protections to implement]
4. **Monitoring Enhancements**: [detection capabilities to add]

## Detailed Analysis References
- [CVE-YYYY-NNNN]-exploit-analysis.md: [Brief description]
- [CVE-YYYY-NNNN]-exploit-analysis.md: [Brief description]
- [CVE-YYYY-NNNN]-exploit-analysis.md: [Brief description]

## Next Steps
1. **Continue Analysis**: [List remaining CVEs to analyze]
2. **Remediation Planning**: [Implementation timeline recommendations]
3. **Validation Testing**: [Post-fix verification requirements]

**Generated**: [timestamp]
**Analyst**: [name/team]
```

## Iterative CVE Processing Workflow

**Prerequisites**:
- Access to security report with CVE vulnerability findings
- OCV-MCP server running for CVE intelligence gathering
- Code repository access for CVE library analysis
- Safe testing environment for CVE PoC validation

**Complete CVE Analysis Process**:

### Initial Setup (Once per report)
1. **Parse Security Report**: Extract ALL CVEs and create comprehensive inventory
2. **Prioritize CVE Queue**: Sort all CVEs by risk, severity, and exploitability
3. **Initialize Progress Tracking**: Set up analysis queue management

### Iterative CVE Processing (Repeat for each CVE)
1. **Select Next CVE**: Choose highest priority CVE from remaining queue
2. **Deep Research**: Use OCV-MCP to gather comprehensive intelligence for current CVE only
3. **Library Analysis**: Trace how application uses the current CVE-affected library
4. **PoC Development**: Create safe demonstration of current CVE exploitability (documentation only)
5. **Document CVE**: Write individual CVE exploit analysis document
6. **Save and Clear**: Store document as `[CVE-ID]-exploit-analysis.md` and clear analysis context
7. **Update Progress**: Mark CVE complete and select next CVE

### Session Management
- **Context Clearing**: After each CVE analysis, clear all context related to that specific CVE
- **Progress Persistence**: Maintain queue status and completed CVE list across context resets
- **Memory Management**: Monitor context usage and clear when approaching limits
- **Resumable Process**: Can stop and resume at any point in the CVE queue

### Completion Options
- **Continue Processing**: Move to next CVE in queue with fresh context
- **Generate Summary**: Create executive summary of all completed analyses
- **Session Break**: Save progress and resume later if needed

**Context Management Strategy**:
```
CVE Queue: [CVE-1, CVE-2, CVE-3, CVE-4, CVE-5...]

Analysis Cycle 1:
‚îú‚îÄ‚îÄ Load CVE-1 details only
‚îú‚îÄ‚îÄ Analyze CVE-1 thoroughly
‚îú‚îÄ‚îÄ Generate CVE-1 document
‚îú‚îÄ‚îÄ Save CVE-1 document
‚îî‚îÄ‚îÄ Clear CVE-1 context

Analysis Cycle 2:
‚îú‚îÄ‚îÄ Load CVE-2 details only (fresh context)
‚îú‚îÄ‚îÄ Analyze CVE-2 thoroughly
‚îú‚îÄ‚îÄ Generate CVE-2 document
‚îú‚îÄ‚îÄ Save CVE-2 document
‚îî‚îÄ‚îÄ Clear CVE-2 context

[Continue for all CVEs...]

Executive Summary:
‚îú‚îÄ‚îÄ Load list of completed CVE documents
‚îú‚îÄ‚îÄ Generate high-level overview
‚îú‚îÄ‚îÄ Create business impact assessment
‚îî‚îÄ‚îÄ Save executive summary
```

**CVE Quality Assurance**:
- **Safe CVE Testing**: All PoCs must be non-destructive and CVE-focused
- **CVE Accuracy Verification**: CVE exploits must work with documented usage patterns
- **Clear CVE Documentation**: Step-by-step instructions for CVE exploit reproduction
- **CVE Remediation Focus**: Emphasis on CVE library updates and usage pattern fixes
- **‚ö†Ô∏è NO EXPLOIT FILES**: Do NOT create actual exploit scripts, attack tools, or executable proof-of-concept files. All demonstrations should remain as theoretical examples in the documentation.

**Iterative CVE Deliverables**:
- One detailed CVE exploit analysis document per CVE (generated individually)
- Working CVE-specific proof-of-concept demonstrations (documentation only - no executable files)
- CVE library usage risk assessment with business impact (per CVE)
- CVE library update and remediation guidance with validation instructions (per CVE)
- Progress tracking of completed vs remaining CVEs
- Executive summary after processing all or significant number of CVEs

**File Organization**:
```
docs/security/reports/[report-name]/
‚îú‚îÄ‚îÄ [original-security-report].md
‚îú‚îÄ‚îÄ CVE-2023-XXXX-exploit-analysis.md    # Generated in cycle 1
‚îú‚îÄ‚îÄ CVE-2023-YYYY-exploit-analysis.md    # Generated in cycle 2
‚îú‚îÄ‚îÄ CVE-2023-ZZZZ-exploit-analysis.md    # Generated in cycle 3
‚îú‚îÄ‚îÄ CVE-2023-AAAA-exploit-analysis.md    # Generated in cycle 4
‚îú‚îÄ‚îÄ CVE-2023-BBBB-exploit-analysis.md    # Generated in cycle 5
‚îî‚îÄ‚îÄ executive-summary-exploit-analysis.md # Generated after multiple cycles
```

**Context Management Benefits**:
- **No Memory Overflow**: Each CVE analysis starts with fresh context
- **Deep Analysis**: Full attention on current CVE without interference
- **Scalable Process**: Can handle any number of CVEs without performance degradation
- **Quality Consistency**: Each CVE gets same level of thorough analysis
- **Resumable Progress**: Can stop and restart at any point in the queue

**üö® IMPORTANT LIMITATION**: This workflow produces ANALYSIS DOCUMENTATION only. No actual exploit files, attack scripts, payload files, or executable proof-of-concept code should be created. All exploit demonstrations must remain as theoretical examples within the documentation.

**SCOPE REMINDER**: This workflow ONLY analyzes vulnerabilities with CVE identifiers. Custom application vulnerabilities, OWASP findings, configuration issues, and business logic flaws are explicitly excluded from this analysis.
